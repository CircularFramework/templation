{"version":3,"sources":["../../src/functions/dom.functions.js"],"names":["createTemporaryDOM","template","data","directives","tempDOM","cloneNode","parseDirectives","filter","dir","isPre","content","virtualizeDOM","element","vElement","type","nodeName","props","children","value","includes","nodeValue","attributes","i","length","a","push","name","childNodes","forEach","c","updateDOM","parent","newNode","oldNode","index","newDOMNode","createElement","appendChild","removeChild","hasChanged","replaceChild","updateProps","newLength","oldLength","node1","node2","dirs","sort","b","order","selectors","subSelectors","selector","ss","directiveElement","querySelector","details","getDirectiveDetails","parser","directive","replace","isPost","toLowerCase","attrVal","getAttribute","removeAttribute","subSelector","split","node","document","createTextNode","createComment","$el","setProps","map","bind","isEventProp","prop","test","setProp","target","setAttribute","removeProp","newProps","oldProps","match","find","p","emptyElement","firstChild"],"mappings":"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","file":"dom.functions.js","sourcesContent":["/** import functions */\nimport { using } from './using.function';\nimport { templater } from './templater.function';\n\n/** create a temporary DOM object based on the template */\nfunction createTemporaryDOM(template, data, directives) {\n\t/** create new template */\n\tlet tempDOM = template.cloneNode(true);\n\n\t/** cycle through pre directives */\n\tparseDirectives(directives.filter(dir => dir.isPre()), tempDOM.content, data);\n\n\t/** replace simple template values */\n\ttemplater(tempDOM, data);\n\n\t/** return the virtual DOM */\n\treturn tempDOM;\n}\n\n/** virtualize the passed DOM element */\nfunction virtualizeDOM(element) {\n\tlet vElement = { type: element.nodeName, props: [], children: [], value: '' };\n\tif (['#text', '#comment'].includes(element.nodeName)) vElement.value = element.nodeValue;\n\n\tif (element.attributes) {\n\t\tfor (let i = 0; i < element.attributes.length; i++) {\n\t\t\tlet a = element.attributes[i];\n\t\t\tvElement.props.push({ 'name': a.name, 'value': a.value });\n\t\t}\n\t}\n\n\tif (element.childNodes) {\n\t\telement.childNodes.forEach(c => {\n\t\t\tvElement.children.push(virtualizeDOM(c));\n\t\t});\n\t}\n\n\treturn vElement;\n}\n\n/** update the given parent with new virtual DOM nodes */\nfunction updateDOM(parent, newNode, oldNode, index) {\n\tif (!index) index = 0;\n\n\tif (!oldNode) {\n\t\tif (newNode) {\n\t\t\tlet newDOMNode = createElement(newNode);\n\t\t\tparent.appendChild(newDOMNode);\n\t\t}\n\t} else if (!newNode) {\n\t\tparent.removeChild(parent.childNodes[index]);\n\t} else if (hasChanged(newNode, oldNode)) {\n\t\tlet newDOMNode = createElement(newNode);\n\t\tparent.replaceChild(newDOMNode, parent.childNodes[index]);\n\t} else if (newNode.type) {\n\t\tupdateProps(parent.childNodes[index], newNode.props, oldNode.props);\n\n\t\tconst newLength = newNode.children.length;\n\t\tconst oldLength = oldNode.children.length;\n\t\t\n\t\t/** check for less new than old */\n\t\tif (newLength < oldLength) {\n\t\t\t/** get all the old elements that are past the new */\n\t\t\tlet children = [];\n\t\t\tfor (let i = newLength; i < oldLength; i++) {\n\t\t\t\tchildren.push(parent.childNodes[index].childNodes[i]);\n\t\t\t}\n\n\t\t\t/** remove old elements */\n\t\t\tchildren.forEach(c => parent.childNodes[index].removeChild(c));\n\t\t}\n\n\t\t/** compare all new nodes */\n\t\tfor (let i = 0; i < newLength; i++) {\n\t\t\tupdateDOM(parent.childNodes[index], newNode.children[i], oldNode.children[i], i);\n\t\t}\n\t}\n}\n\n/** check to see if has changed */\nfunction hasChanged(node1, node2) {\n\treturn (typeof node1 !== typeof node2) || (node1.type !== node2.type) || (['#text', '#comment'].includes(node1.type) && node1.value !== node2.value);\n}\n\n/** find references to the given directives on the given element and parse */\nfunction parseDirectives(dirs, element, data) {\n\t/** sort the directives */\n\tdirs.sort(function(a, b) {\n\t\treturn a.order - b.order;\n\t});\n\n\t/** execute each directive */\n\tdirs.forEach(dir => {\n\t\t/** create an array of selectors */\n\t\tlet selectors = [];\n\n\t\t/** check for sub selectors */\n\t\tif (dir.subSelectors.length > 0) {\n\t\t\t/** cycle thru sub selectors */\n\t\t\tdir.subSelectors.forEach(ss => {\n\t\t\t\t/** add the selector with sub selector */\n\t\t\t\tselectors.push(`${dir.selector}\\\\:${ss}`);\n\t\t\t});\n\t\t} else {\n\t\t\t/** add the single selector */\n\t\t\tselectors.push(dir.selector);\n\t\t}\n\n\t\t/** cycle through selectors */\n\t\tselectors.forEach(selector => {\n\t\t\t/** initialize the directive elements */\n\t\t\tlet directiveElement;\n\t\t\twhile ((directiveElement = element.querySelector(`[${selector}]`)) !== null) {\n\t\t\t\tlet details = getDirectiveDetails(directiveElement, dir, selector);\n\t\t\t\tdir.parser(details, directiveElement, data);\n\t\t\t}\n\t\t});\n\t});\n}\n\n/** get the attribute name (selector), sub selector, and value of a directive */\nfunction getDirectiveDetails(element, directive, selector) {\n\t/** initialize the details */\n\tlet details = { 'value': null, 'subSelector': null };\n\n\t/** get the selector */\n\tselector = selector.replace('\\\\', '');\n\tif (directive.isPost()) selector = selector.toLowerCase();\n\n\t/** get the attribute value expression, and remove the attribute */\n\tvar attrVal = element.getAttribute(selector);\n\telement.removeAttribute(selector);\n\n\t/** set details */\n\tdetails.value = attrVal;\n\n\t/** check for sub selector */\n\tif (selector.includes(':')) details.subSelector = selector.split(':')[1];\n\n\t/** return the details */\n\treturn details;\n}\n\n/** create a DOM element based on the virtual DOM node passed */\nfunction createElement(node) {\n\tif (node.type === '#text') {\n\t\treturn document.createTextNode(node.value);\n\t}\n\tif (node.type === '#comment') {\n\t\treturn document.createComment(node.value);\n\t}\n\tconst $el = document.createElement(node.type);\n\tsetProps($el, node.props);\n\tnode.children.map(createElement).forEach($el.appendChild.bind($el));\n\treturn $el;\n}\n\n/** check this property to see if it is an event property */\nfunction isEventProp(prop) {\n\treturn /^cron:/.test(prop.name);\n}\n\n/** set a target element's property value */\nfunction setProp(target, prop) {\n\ttarget.setAttribute(prop.name, prop.value);\n}\n\n/** set multiple property values on a target element */\nfunction setProps(target, props) {\n\tprops.forEach(prop => {\n\t\tsetProp(target, prop);\n\t});\n}\n\n/** remove a property from a target element */\nfunction removeProp(target, prop) {\n\ttarget.removeAttribute(prop.name);\n}\n\n/** update the properties on a target element */\nfunction updateProps(target, newProps, oldProps) {\n\tnewProps.forEach(prop => {\n\t\tlet match = oldProps.find(p => p.name === prop.name);\n\t\tif (match) {\n\t\t\tif (match.value !== prop.value) setProp(target, prop); // update\n\t\t} else {\n\t\t\tif (!isEventProp(prop)) {\n\t\t\t\tsetProp(target, prop); // add new\n\t\t\t}\n\t\t}\n\t});\n\toldProps.forEach(prop => {\n\t\tlet match = newProps.find(p => p.name === prop.name);\n\t\tif (!match) {\n\t\t\tremoveProp(target, prop);\n\t\t}\n\t});\n}\n\n/** empty an element of all children */\nfunction emptyElement(element) {\n\twhile (element.firstChild) element.removeChild(element.firstChild);\n};\n\n/** export the DOM related functions */\nexport {\n\tcreateTemporaryDOM,\n\tvirtualizeDOM,\n\tupdateDOM,\n\thasChanged,\n\tparseDirectives,\n\tcreateElement,\n\tisEventProp,\n\tsetProp,\n\tsetProps,\n\tremoveProp,\n\tupdateProps,\n\temptyElement\n};"]}